### 上下文管理器和else块

`with`语句会设置一个临时的上下文，交给上下文管理器对象控制，并且负责清理上下文。这么做能避免错误并减少样板代码，因此API更安全，而且更易于使用。除了自动关闭文件外，`with`块还有很多用途。

这个语言特性不是什么秘密，但却没有得到重视：`else`子句不仅能在if语句中使用，还能在for、while、try语句中使用。

在所有情况下，如果异常或return、break、continue语句导致控制权跳到了复合语句的主块之外，else字句也会被跳过。

上下文管理器对象存在的目的是管理`with`语句，就像迭代器的存在是为了管理for语句一样。

`with`语句的目的是简化`try/finally`模式。这种模式用于保证一段代码运行完毕后执行某项操作，即便那段代码由于异常、return语句或sys.exit()调用而中止，也会执行指定的操作。`finally`子句中的代码通常用于释放重要的资源，或者还原临时变更的状态。

上下文管理协议包括`__enter__`和`__exit__`两个方法。`with`语句开始运行时，会在上下文管理器对象上调用`__enter__`方法。`with`语句运行结束后，会在上下文管理器对象上调用`__exit__`方法，以此扮演`finally`子句的角色。
